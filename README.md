# BL4P

BL4P (pronounced: BLAP) is a cryptocurrency exchange that only holds users' fiat
currency.
BL4P's atomic swap functionality allows users to exchange fiat and
cryptocurrency between each other, for instance using the Lightning network.
The concept was described earlier in:

https://gitlab.bitonic.nl/Corne/Lightning-integration-concepts/blob/master/Decentralized_exchange_bank_style.md

This project contains the following:

* The fiat-managing server
* The marketplace server (centralized, for now)
* The API definition (for Python)

# Installation

Requires:

* Python 3
* Websockets for Python (in Debian: python3-websockets package)
* Websocket-client for Python (in Debian: python3-websocket package)
* Python 3 Protobuf (in Debian: python3-protobuf package)
* Protoc protobuf compiler (in Debian: protobuf-compiler package)

Currently, there is no installation procedure.
Just run the program from the source tree.

# Usage

BL4P can be started by starting `./bl4p.py` from the root of the source tree.

Some important limitations:

* This prototype keeps all data in RAM.
  This means that data is non-persistent, and that scalability is limited by the
  amount of RAM.
  This is not suitable for actual deployment.
* The only way to add new users in this prototype is by editing bl4p.py and
  restarting the application.
  This is not suitable for actual deployment.
* In this prototype, authentication consists of checking that the supplied
  password equals the supplied user ID.
  Needless to say, this is not suitable for actual deployment.
* There is no DoS prevention.

# Development and design

There is a unit test suite in the test directory.
It can be started by starting `make test` from the root of the source tree.
The test suite keeps track of code coverage; for this, it requires
python-coverage to be installed (in Debian: python3-coverage package).
Code coverage results are summarized in the console output;
a detailed view of code coverage is exported as HTML in test/coverage_html.

The API definition, including protobuf-files, is in the api directory.
This API definition is intended to be used by both the server and by any client
software. Since some of it is written in Python, a couple of things need to be
re-implemented for clients developed in other languages.
Whenever the protobuf-files are changed, the corresponding *_pb2.py source files
need to be re-generated by running `make proto`.

The API is intended to be an extension of the Kimura API, and therefore it
follows the same general design, combining websockets and protobuf.
The API essentially consists of two separate parts:

* The BL4P API, which allows users to perform the fiat-side of their
  transactions, following the BL4P protocol.
* The offerbook API, which allows users to advertize their deals to other users.

In the future, users might want to migrate to a decentralized offerbook.
It will be perfectly possible to keep using the BL4P API without using the
offerbook API, or to keep using the offerbook API together with a peer-to-peer
exchange of offers.
The offer format (in offer.proto) is intended to be used in a future
peer-to-peer offer exchange network as well as in the centralized offer exchange
hosted by BL4P.

